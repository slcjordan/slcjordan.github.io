  <!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> Introduction to actors in Go &middot; Jordan Crabtree </title>
    
    <link rel="stylesheet" type="text/css" href="http://localhost:1313//css/uno.min.css" />
    <link rel="stylesheet" type="text/css" href="http://localhost:1313//css/lightGallery.css" />
    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.ico">
    
    <link href="" rel="alternate" type="application/rss+xml" title="Jordan Crabtree" />
    
    <script src="http://localhost:1313//js/jquery.min.js"></script>
    <script src="http://localhost:1313//js/main.min.js">
    </script>
</head>

  <body>
    <div id="scriptHeader">
    <span class="mobile btn-mobile-menu">
            <i class="fa fa-bars btn-mobile-menu__icon"></i>
            <i class="fa fa-times btn-mobile-close__icon hidden"> </i>
    </span>
    <header class="
        
            panel-cover panel-cover--collapsed
        "  style="background-image: url(/images/hawaii.jpg)" >
    <div class="panel-main">
        <div class="panel-main__inner panel-inverted">
            <div class="panel-main__content"> 
                <h1 class="panel-cover__title panel-title">
                    <a href="http://localhost:1313//"  title="link to homepage for Jordan Crabtree">Jordan Crabtree</a>
                </h1>
                <hr class="panel-cover__divider" />
                <p class="panel-cover__description">  Salt Lake City Software Developer and go enthusiast.  </p>
                <hr class="panel-cover__divider panel-cover__divider--secondary" />
                <div class="navigation-wrapper">
                    <nav class="cover-navigation cover-navigation--primary">
                        <ul class="navigation">
                            <li class="navigation__item"><a href="http://localhost:1313//#blog" title="link to Jordan Crabtree blog" class="blog-button">Blog</a> </li>
                            </br>  </ul>
                    </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/jdevslc" title="@jdevslc on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>    </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/pub/jordan-crabtree/1b/62/923" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>   </ul>
</nav>
 </div>
            </div>
        </div>
        <div class="panel-cover--overlay"></div>
    </div>
</header>
</div>
<noscript>
    <style>
        #scriptHeader {display:none;}
        .navigation-wrapper{
            display: block;
            top: 0;
        }
    </style>

    <header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/hawaii.jpg)">
        <div class="panel-main">
            <div class="panel-main__inner panel-inverted">
                <div class="panel-main__content"> 
                    <h1 class="panel-cover__title panel-title">
                        <a href="http://localhost:1313//"  title="link to homepage for Jordan Crabtree">Jordan Crabtree</a>
                    </h1>
                    <hr class="panel-cover__divider" />
                    <p class="panel-cover__description">  Salt Lake City Software Developer and go enthusiast.  </p>
                    <hr class="panel-cover__divider panel-cover__divider--secondary" />
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                            <ul class="navigation">
                                <li class="navigation__item"><a href="http://localhost:1313//#blog" title="link to Jordan Crabtree blog" class="blog-button">Blog</a> </li>
                                </br>  </ul>
                        </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/jdevslc" title="@jdevslc on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>    </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/pub/jordan-crabtree/1b/62/923" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>   </ul>
</nav>
 </div>
                </div>
            </div>
            <div class="panel-cover--overlay"></div>
        </div>
    </header>
</noscript>

    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <div class="post">
          <h1>Introduction to actors in Go</h1>
          <span class="post-date">Tue, Aug 25, 2015</span>
          

<p>Among the many challenges that multi-threaded programming can present is that of the dreaded race condition. Race conditions occur when a thread modifies state and another thread accesses that state without any synchronization events. Actors avoid race conditions by assigning a single thread to act on behalf of other threads to modify state.</p>

<h2 id="concurrency-problems:815a9d53980737ee4b1ad0ef442c062c">Concurrency Problems</h2>

<p><img src="/images/racers.jpg" alt="racers" /></p>

<p>This go program is supposed to concurrently increment a counter. It spins up a thousand threads, each calling the <em>increment</em> function. The program correctly waits for each thread to finish, but without any synchronization event to control access to the <em>counter</em> variable, we get unpredictable behavior:</p>

<pre><code>package main

import (
    &quot;fmt&quot;
    &quot;runtime&quot;
    &quot;sync&quot;
)

var counter = 0
var wg = sync.WaitGroup{}

func increment() {
    counter++
    wg.Done()
}

func main() {
    runtime.GOMAXPROCS(runtime.NumCPU())

    for i := 0; i &lt; 1000; i++ {
        wg.Add(1)
        go increment()
    }

    wg.Wait()
    fmt.Println(counter)
}
</code></pre>

<p>Here is the output from multiple runs of the program, and the last run has the race dector flag enabled:</p>

<pre><code>[/tmp]$ go run actor.go
939
[/tmp]$ go run actor.go
945
[/tmp]$ go run --race actor.go
==================
WARNING: DATA RACE
Read by goroutine 6:
  main.increment()
      /tmp/actor.go:13 +0x38

Previous write by goroutine 5:
  main.increment()
      /tmp/actor.go:13 +0x54

Goroutine 6 (running) created at:
  main.main()
      /tmp/actor.go:22 +0x7f

Goroutine 5 (finished) created at:
  main.main()
      /tmp/actor.go:22 +0x7f
==================
1000
Found 1 data race(s)
exit status 66
</code></pre>

<h2 id="what-is-an-actor:815a9d53980737ee4b1ad0ef442c062c">What is an actor?</h2>

<p><img src="/images/zoolander.jpg" alt="zoolander" /></p>

<p>An actor is a big name for a simple concept: Never allowing multiple threads to access state&hellip; Instead delegate a single thread to process requests for state access and modification. Let&rsquo;s modify our code to use an actor thread to execute our increments:</p>

<pre><code>...
var actions = make(chan func())

func actor() {
    for action := range actions {
        action()
    }
}

func main() {
    runtime.GOMAXPROCS(runtime.NumCPU())
    go actor()

    for i := 0; i &lt; 1000; i++ {
        wg.Add(1)
        actions &lt;- increment
    }
    ...
</code></pre>

<p>now we get the desired output</p>

<pre><code>[/tmp]$ go run --race actor.go 
1000
</code></pre>

<h2 id="matrix-multiplication-using-actors:815a9d53980737ee4b1ad0ef442c062c">Matrix multiplication using actors</h2>

<p>Using actors to multiply matrices is nothing new. Here&rsquo;s how:</p>

<p>Just to review, to get the i, jth entry of the product, take the ith row of the first matrix and multiply entry by entry with the jth column of the second matrix.</p>

<p><img src="/images/matrix_multiply.jpg" alt="matrix_multiply" /></p>

<p>The ith row of the result can be deduced by considering the ith row of the first matrix being multiplied with all of the second matrix.</p>

<p><img src="/images/row_vector_multiply.jpg" alt="vector_multiply" /></p>

<p>By using an actor for each of the rows, the ith row can be computed and replaced concurrently and in a threadsafe way. Here&rsquo;s a gist to demonstrate:</p>

<p><a href="http://gist.github.com/slcjordan/e05de3ab485321ff6cbd">gist.github.com/slcjordan/e05de3ab485321ff6cbd</a></p>

        </div>
        <div class="sharing">
<a href="https://twitter.com/intent/tweet?status=Introduction%20to%20actors%20in%20Go-http%3a%2f%2flocalhost%3a1313%2fpost%2factor%2f" target="_blank" title="Follow me on Twitter" class="twitter">
<span class="fa fa-twitter-square fa-3x"></span></a>
<a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fpost%2factor%2f" target="_blank" title="Join me on Facebook" class="facebook">
<span class="fa fa-facebook-square fa-3x"></span></a>
<a href="https://plus.google.com/share?url=http%3a%2f%2flocalhost%3a1313%2fpost%2factor%2f" target="_blank" title="Google+" class="googleplus">
<span class="fa fa-google-plus-square fa-3x"></span></a>
<a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2flocalhost%3a1313%2fpost%2factor%2f&title=Introduction%20to%20actors%20in%20Go" target="_blank" title="LinkedIn" class="linkedin">
<span class="fa fa-linkedin-square fa-3x"></span></a>
<a href="http://www.reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fpost%2factor%2f" target="_blank" title="Reddit" class="reddit"><span class="fa fa-reddit-square fa-3x"></span></a>
<a href="http://www.stumbleupon.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fpost%2factor%2f" target="_blank" title="StumbleUpon" class="stumbleupon"><span class="fa fa-stumbleupon fa-3x">
</span></a>
</div>
        


      </div>
    </div>

  </body>
  
</html>
